name: List Repo Users and Admin Count

on:
  push:  
  workflow_dispatch:

jobs:
  list-users:
    runs-on: ubuntu-latest
    steps:
      - name: Fetch repository collaborators
        id: fetch_collaborators
        run: |
          # Fetch all collaborators with their permissions
          echo "Fetching repository collaborators with permissions..."
          curl -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
               -H "Accept: application/vnd.github.v3+json" \
               "https://api.github.com/repos/${{ github.repository }}/collaborators" > collaborators.json
          
      - name: List all repository users
        id: list_users
        run: |
          # List all usernames
          echo "Users in the repository:"
          jq -r '.[].login' collaborators.json

      - name: Count admin users
        id: count_admins
        run: |
          # Count the number of admin users
          admin_count=$(jq '[.[] | select(.permissions.admin == true)] | length' collaborators.json)
          echo "Number of admin users: $admin_count"
