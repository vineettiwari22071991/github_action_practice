name: Check PR Description

on:
  pull_request:
    types: [opened, edited, reopened]
    branches:
      - main

jobs:
  check-pr-description:
    runs-on: ubuntu-latest

    steps:
      - name: Check PR Description
        id: check-description
        run: |
          # Debug: Show the event payload
          cat "$GITHUB_EVENT_PATH"

          # Extract PR description
          PR_DESCRIPTION=$(jq -r .pull_request.body "$GITHUB_EVENT_PATH")

          # Debug: Print the PR description
          echo "PR_DESCRIPTION: '${PR_DESCRIPTION}'"

          # Check if PR description is empty or 'null'
          if [ -z "$PR_DESCRIPTION" ] || [ "$PR_DESCRIPTION" == "null" ]; then
            echo "PR_DESCRIPTION is empty or 'null'"
            exit 1
          else
            echo "PR_DESCRIPTION is present"
          fi

      - name: Send message if PR description is missing
        if: failure()
        uses: actions/github-script@v6
        with:
          script: |
            const { github, context } = require('@actions/github'); // Import context as well
            const message = 'Please fill in an adequate commit message; please note that PR commit messages might get published in release notes as well.';
            await github.rest.issues.createComment({
              ...context.repo,
              issue_number: context.issue.number,
              body: message
            });

      - name: Fail the PR if description is missing
        if: failure()
        run: |
          echo "PR description is missing. Failing the PR."
          exit 1
